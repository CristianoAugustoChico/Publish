$(function(){function e(e,o,t){var n=$('<div style="height:25px;">');o.endsWith(".png")?n.append($('<div class="legend-img-box">').css("background-image","url("+o+")")):n.append($('<div class="legend-color-box">').css({backgroundColor:o})),n.append($("<span>").css("lineHeight","23px").html(t)),e.append(n)}function o(o){R.empty(),U.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,n){var i=o[n];e(R,i,n)})}function t(e,t){var n=e.label,i=t||"Description",r=e.description.split("."),s=r[0]?r[0]+".":"",a=le+40,l=40*(ce-a)/100,c=20*(ce-a)/100;ae.height()<l&&(c=30*(ce-a)/100),ae.css("max-height",l),J.css("max-height",c),A.css("max-height",c),r.length-1>1?se.show():se.hide(),B.text(" "+i),F.text(s||""),ne.text(" "+i),ie.text(e.description||""),o(n)}function n(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function i(e){var o=e.color;if(e.slices){var t=Object.keys(o).sort(function(e,o){return e-o}),n=t.map(Number);return function(e){var i=null;return $.each(n,function(n,r){e>=r&&(i=o[t[n]])}),i}}return function(e){return o[e]}}function r(e,o){var t=o.geom||e.getGeometry().getType(),n=N(o,1),r=i(o);if(!o.icon||"Point"!==t&&"MultiPoint"!==t){var s=n||o.id,a=o.color;"object"===$.type(a)?e.setProperty("color",r(e.getProperty(s))):e.setProperty("color",a),e.setProperty("border",o.border),e.setProperty("width",o.width)}else{var l=o.icon.options[e.getProperty(n)];l||(l=o.icon.path),e.setProperty("icon",l)}e.setProperty("order",o.order)}function s(e,o){var t=o.id;e.setStyle(n),o.report&&e.addListener("click",function(e){if("function"===o.report){var n=e.feature.getProperty(N(o,0));"string"===$.type(n)&&(n=n.replace(/\s/g,"")),$("#modal-report-"+t+n).modal("show")}else $("#modal-report-"+t).modal("show")}),j[t]=e}function a(e,o,t){$.each(o,function(o,n){n.getVisible()?y(e,n):(v(e,n,t),h(e,J.hasClass("in"),A.hasClass("in")))})}function l(e){return"LineString"===e.geom}function c(e){return"MultiLineString"===e.geom}function d(e){return l(e)||c(e)}function p(e,o){var t=Publish.path+e+".geojson";return $.getJSON(t,function(t){var n=new google.maps.Data;n.addGeoJson(t),d(o)?w(n,o):(P(n,o),n.setMap(S),G(e,!0))})}function u(e){var o=j[e],t=Publish.data[e];if(o)if(d(t)){var n=t.icon.time;l(t)?a(t.id,o,n):$.each(o,function(e,o){a(t.id,o,n)})}else o.getMap()?(o.setMap(null),G(e,!1)):(o.setMap(S),G(e,!0),h(e,J.hasClass("in"),A.hasClass("in")));else k(),_.empty(),x(e,1,1),p(e,t).done(function(){h(e,J.hasClass("in"),A.hasClass("in"))}).always(function(){M()})}function f(e,o){Z=null,R.empty(),F.empty(),B.text(" Description"),K.hide(),$("button").removeClass("button-selected"),e&&(B.click(),B.prop("disabled",!0)),o&&(U.click(),U.prop("disabled",!0))}function h(e,o,n){Z=e;var i=Publish.data[e];if(t(i,E[e]),o||(B.prop("disabled",!1),B.click()),n||(U.prop("disabled",!1),U.click()),i.download){var r=e+".zip";q.prop("href",Publish.path+r),q.prop("download",r),K.show()}else K.hide();$("button").removeClass("button-selected"),$("#"+e).addClass("button-selected")}function g(e){var o=e.target.id;if(o){var t=J.hasClass("in"),n=A.hasClass("in");Z===o?f(t,n):h(o,t,n)}else{if(!(o=e.target.name))return;var i=Publish.group;if(i){var r=Publish.data[o].group,s=i[r];s?(u(s),s===o?i[r]=null:(i[r]=o,u(o))):(i[r]=o,u(o))}else u(o)}}function m(e,o,t){var n=0,i=setInterval(function(){n=(n+1)%200;var e=o.get("icons");e[0].offset=n/2+"%",o.set("icons",e)},t);window.intervals||(window.intervals={}),window.intervals[e]||(window.intervals[e]=[]),window.intervals[e].push(i)}function b(e,o){var t=e.icon.options,n=[];o.forEachLatLng(function(e){n.push(e)});var i={path:t.path,anchor:new google.maps.Point(175,175),scale:.1,fillColor:t.fillColor,fillOpacity:t.fillOpacity,strokeWeight:t.strokeWeight},r={path:n,icons:[{icon:i}],strokeWeight:e.width,strokeColor:e.border||e.color,strokeOpacity:e.transparency};return new google.maps.Polyline(r)}function v(e,o,t){o.setMap(S),o.setVisible(!0),m(e,o,t)}function y(e,o){o.setMap(null),o.setVisible(!1),window.intervals&&$.each(window.intervals[e],function(e,o){clearInterval(o)})}function w(e,o){var t=[],n=o.visible,i=o.icon.time;e.forEach(function(e){var r=e.getGeometry();if(l(o)){var s=b(o,r);t.push(s),n&&v(o.id,s,i)}else if(c(o)){var a=[];$.each(r.getArray(),function(e,t){var r=b(o,t);a.push(r),n&&v(o.id,r,i)}),t.push(a)}}),j[o.id]=t,n&&G(o.id,!0)}function P(e,o){e.forEach(function(e){r(e,o)}),s(e,o)}function C(e,o,t){return"Loading"+E[e]+" ("+o+"/"+t+")"}function x(e,o,t){var n=C(e,o,t);_.text(n)}function k(){H.fadeIn(),V.css("z-index",1e7)}function M(){H.fadeOut(),_.empty(),V.css("z-index",-1)}function O(e,o){function t(e,o,t){return Math.floor(Math.log(e/o/t)/Math.LN2)}if("number"===$.type(e))return e;var n=t(ce,e.yTile,e.latFraction),i=t(re.width(),e.xTile,e.longFraction);return Math.min(n,i,o)}function T(e){var o=[],t=0,n=Object.keys(e).length;k(),$.each(e,function(e,i){if(W(i),!i.visible)return!0;t+=1,_.empty(),x(e,t,n),o.push(p(e,i))}),$.when.apply($,o).always(function(){M()})}function z(){google.maps.visualRefresh=!0;var e={center:new google.maps.LatLng(Publish.center.lat,Publish.center.long),zoom:O(Publish.zoom,Publish.maxZoom),minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};S=new google.maps.Map(re[0],e),S.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),I(),google.maps.event.addListenerOnce(S,"idle",function(){T(Publish.data)})}function I(){var e=$("#layers"),o=e.find(":button");o.each(function(e,o){E[o.id]=o.innerText}),o.click(g),B.prop("disabled",!0),U.prop("disabled",!0),K.hide()}function L(){if(Q.is(":visible"))re.find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed");else{var e=$(".sidebar-left");re.find(".ol-zoom").css("margin-left",e.width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}if($("#logo")){var o=le-50;$("body").css("padding-top",o),Q.css("margin-top",o)}}function D(){return X.width()===$(window).width()}function W(e){e.label||(e.label={},e.label[e.id]=e.color||e.border)}function G(e,o){$("#"+e).children("input").prop("checked",o)}function N(e,o){return"array"===$.type(e.select)?e.select[o]:e.select}var S,Z,j={},E={},R=$("#legend"),H=$("#loader"),V=$("#loader-message"),_=$("#loader-message-text"),F=$("#layer-description"),J=$("#properties"),A=$("#legends"),B=$("#description-title"),U=$("#legend-title"),q=$("#download-title"),K=$("#panel-download"),Q=$(".mini-submenu-left"),X=$(".sidebar"),Y=$(".sidebar-left .sidebar-body"),ee=$(".sidebar-left .slide-submenu"),oe=$("#modal-app-description"),te=$("#modal-completed-description"),ne=$("#modal-title-description"),ie=$("#info-description"),re=$("#map"),se=$("#more"),ae=$("#layers"),le=$(".navbar").height(),ce=re.height();google.maps.event.addDomListener(window,"load",z),ee.on("click",function(){$(this).closest(".sidebar-body").fadeOut("slide",function(){Q.fadeIn(),L()})}),Q.on("click",function(){var e=$(this);Y.toggle("slide"),e.hide(),L()}),se.on("click",function(){te.modal("show")}),$(window).on("resize",L),oe.modal("show"),function(){D()&&(Y.fadeOut("slide"),Q.fadeIn())}(),L()});