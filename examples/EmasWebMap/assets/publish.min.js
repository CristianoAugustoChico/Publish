$(function(){function e(e,o,t){var n=$('<div style="height:25px;">').append($('<div class="legend-color-box">').css({backgroundColor:o})).append($("<span>").css("lineHeight","23px").html(t));e.append(n)}function o(o){P.empty(),T.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,n){var i=o[n];e(P,i,n)})}function t(e,t){var n=e.label,i=t||"Description";O.text(" "+i),w.text(e.description||""),o(n)}function n(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function i(e,o,t,n){var i=e.getGeometry(),a=i.getType();return"Point"===a||"MultiPoint"===a?e.setProperty("icon",o.icon):("object"==$.type(t)?e.setProperty("color",t[e.getProperty(n)]):e.setProperty("color",t),e.setProperty("border",o.border),e.setProperty("width",o.width)),e.setProperty("order",o.order),i}function a(e,o,t){e.setStyle(n),e.addListener("click",function(e){if(!o.geom||"Point"!==o.geom&&"MultiPoint"!==o.geom)$("#modal-report-"+t).modal("show");else{var n=e.feature.getProperty(o.select);"string"==$.type(n)&&(n=n.replace(/\s/g,"-")),$("#modal-report-"+t+n).modal("show")}}),b[t]=e}function l(e){var o=b[e];if(o)o.getMap()?(o.setMap(null),f(e,!1)):(o.setMap(g),f(e,!0));else{v.fadeIn();var t=Publish.path+e+".geojson";$.getJSON(t,function(t){o=new google.maps.Data;var n=Publish.data[e],l=n.select||e,r=n.color;m(n,e),o.addGeoJson(t),o.forEach(function(e){i(e,n,r,l)}),a(o,n,e),o.setMap(g),f(e,!0)}).always(function(){v.fadeOut()})}return e}function r(e){var o=e.target.id;if(o){y[o]||(y[o]=e.target.innerText);var n=C.hasClass("in"),i=z.hasClass("in");if(h===o)h=null,P.empty(),w.empty(),O.text(" Description"),x.hide(),n&&(O.click(),O.prop("disabled",!0)),i&&(T.click(),T.prop("disabled",!0));else{h=o;var a=Publish.data[o];if(t(a,y[o]),n||(O.prop("disabled",!1),O.click()),i||(T.prop("disabled",!1),T.click()),a.download){var r=o+".zip";k.prop("href",Publish.path+r),k.prop("download",r),x.show()}else x.hide()}}else l(e.target.name)}function s(e){var o=[],t=new google.maps.LatLngBounds;v.fadeIn(),$.each(e,function(e,n){m(n,e);var l=Publish.path+e+".geojson";o.push($.getJSON(l,function(o){var l=new google.maps.Data,r=n.select||e,s=n.color;l.addGeoJson(o),l.forEach(function(e){var o=i(e,n,s,r);o.forEachLatLng(function(e){t.extend(e)})}),a(l,n,e),n.visible&&(l.setMap(g),f(e,!0))}))}),$.when.apply($,o).done(function(){g.fitBounds(t)}).always(function(){v.fadeOut()})}function d(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");g=new google.maps.Map(o,e),g.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),Publish.zoom||google.maps.event.addListenerOnce(g,"idle",function(){s(Publish.data)}),$("#layers").find(":button").click(r),O.prop("disabled",!0),T.prop("disabled",!0),x.hide()}function p(){var e=$(".mini-submenu-left");e.is(":visible")?$("#map").find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed"):$("#map").find(".ol-zoom").css("margin-left",$(".sidebar-left").width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}function c(){return $(".sidebar").width()==$(window).width()}function u(){c()&&($(".sidebar-left .sidebar-body").fadeOut("slide"),$(".mini-submenu-left").fadeIn())}function m(e,o){e.label||(e.label={},e.label[o]=e.color)}function f(e,o){$("#"+e).children("input").prop("checked",o)}var g,h,b={},y={},P=$("#legend"),v=$("#loader"),w=$("#layer-description"),C=$("#properties"),z=$("#legends"),O=$("#description-title"),T=$("#legend-title"),k=$("#download-title"),x=$("#panel-download");google.maps.event.addDomListener(window,"load",d),$(".sidebar-left .slide-submenu").on("click",function(){var e=$(this);e.closest(".sidebar-body").fadeOut("slide",function(){$(".mini-submenu-left").fadeIn(),p()})}),$(".mini-submenu-left").on("click",function(){var e=$(this);$(".sidebar-left .sidebar-body").toggle("slide"),e.hide(),p()}),$(window).on("resize",p),$("#modal-app-description").modal("show"),u(),p()});