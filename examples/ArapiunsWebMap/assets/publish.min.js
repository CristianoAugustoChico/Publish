$(function(){function e(e,o,t){var n=$('<div style="height:25px;">').append($('<div class="legend-color-box">').css({backgroundColor:o})).append($("<span>").css("lineHeight","23px").html(t));e.append(n)}function o(o){C.empty(),M.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,n){var i=o[n];e(C,i,n)})}function t(e,t){var n=e.label,i=t||"Description";x.text(" "+i),O.text(e.description||""),o(n)}function n(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function i(e,o,t,n){var i=e.getGeometry(),a=i.getType();return"Point"===a||"MultiPoint"===a?e.setProperty("icon",o.icon):("object"==$.type(t)?e.setProperty("color",t[e.getProperty(n)]):e.setProperty("color",t),e.setProperty("border",o.border),e.setProperty("width",o.width)),e.setProperty("order",o.order),i}function a(e,o,t){e.setStyle(n),e.addListener("click",function(e){if(!o.geom||"Point"!==o.geom&&"MultiPoint"!==o.geom)$("#modal-report-"+t).modal("show");else{var n=e.feature.getProperty(o.select);"string"==$.type(n)&&(n=n.replace(/\s/g,"-")),$("#modal-report-"+t+n).modal("show")}}),v[t]=e}function s(e){var o=v[e];if(o)o.getMap()?(o.setMap(null),b(e,!1)):(o.setMap(y),b(e,!0),r(e,T.hasClass("in"),k.hasClass("in")));else{z.fadeIn();var t=Publish.path+e+".geojson";$.getJSON(t,function(t){o=new google.maps.Data;var n=Publish.data[e],s=n.select||e,l=n.color;h(n,e),o.addGeoJson(t),o.forEach(function(e){i(e,n,l,s)}),a(o,n,e),o.setMap(y),b(e,!0),r(e,T.hasClass("in"),k.hasClass("in"))}).always(function(){z.fadeOut()})}return e}function l(e,o){P=null,C.empty(),O.empty(),x.text(" Description"),L.hide(),e&&(x.click(),x.prop("disabled",!0)),o&&(M.click(),M.prop("disabled",!0))}function r(e,o,n){P=e;var i=Publish.data[e];if(t(i,w[e]),o||(x.prop("disabled",!1),x.click()),n||(M.prop("disabled",!1),M.click()),i.download){var a=e+".zip";I.prop("href",Publish.path+a),I.prop("download",a),L.show()}else L.hide()}function d(e){var o=e.target.id;if(o){var t=T.hasClass("in"),n=k.hasClass("in");P===o?l(t,n):r(o,t,n)}else s(e.target.name)}function p(e){var o=[],t=new google.maps.LatLngBounds;z.fadeIn(),$.each(e,function(e,n){h(n,e);var s=Publish.path+e+".geojson";o.push($.getJSON(s,function(o){var s=new google.maps.Data,l=n.select||e,r=n.color;s.addGeoJson(o),s.forEach(function(e){var o=i(e,n,r,l);o.forEachLatLng(function(e){t.extend(e)})}),a(s,n,e),n.visible&&(s.setMap(y),b(e,!0))}))}),$.when.apply($,o).done(function(){y.fitBounds(t)}).always(function(){z.fadeOut()})}function c(){var e=$("#layers").find(":button");e.each(function(e,o){w[o.id]=o.innerText}),e.click(d),x.prop("disabled",!0),M.prop("disabled",!0),L.hide()}function u(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");y=new google.maps.Map(o,e),y.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),Publish.zoom||google.maps.event.addListenerOnce(y,"idle",function(){p(Publish.data)}),c()}function f(){var e=$(".mini-submenu-left");e.is(":visible")?$("#map").find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed"):$("#map").find(".ol-zoom").css("margin-left",$(".sidebar-left").width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}function m(){return $(".sidebar").width()==$(window).width()}function g(){m()&&($(".sidebar-left .sidebar-body").fadeOut("slide"),$(".mini-submenu-left").fadeIn())}function h(e,o){e.label||(e.label={},e.label[o]=e.color)}function b(e,o){$("#"+e).children("input").prop("checked",o)}var y,P,v={},w={},C=$("#legend"),z=$("#loader"),O=$("#layer-description"),T=$("#properties"),k=$("#legends"),x=$("#description-title"),M=$("#legend-title"),I=$("#download-title"),L=$("#panel-download");google.maps.event.addDomListener(window,"load",u),$(".sidebar-left .slide-submenu").on("click",function(){var e=$(this);e.closest(".sidebar-body").fadeOut("slide",function(){$(".mini-submenu-left").fadeIn(),f()})}),$(".mini-submenu-left").on("click",function(){var e=$(this);$(".sidebar-left .sidebar-body").toggle("slide"),e.hide(),f()}),$(window).on("resize",f),$("#modal-app-description").modal("show"),g(),f()});