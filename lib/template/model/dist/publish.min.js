$(function(){function e(e,o,t,n){n&&(t=t+" "+n);var a=$('<div style="height:25px;">').append($('<div class="legend-color-box">').css({backgroundColor:o})).append($("<span>").css("lineHeight","23px").html(t));e.append(a)}function o(o,t){c.empty(),$("#legend-title").text(" "+Publish.legend),"object"==$.type(o)?$.each(o,function(o,n){e(c,n,t,o)}):e(c,o,t)}function t(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order")}}function n(e){var n=e.target.id,a=p[n];if(a)if(a.getMap())c.empty(),a.setMap(null);else{var s=Publish.data[n],i=s.select||n,r=s.color;u.text(s.description||""),o(r,i),a.setMap(d)}else{m.fadeIn();var l=Publish.path+n+".geojson";$.getJSON(l,function(e){a=new google.maps.Data;var s=Publish.data[n],i=s.select||n,r=s.color;a.addGeoJson(e),a.forEach(function(e){"object"==$.type(r)?e.setProperty("color",r[e.getProperty(i)]):e.setProperty("color",r),e.setProperty("border",s.border),e.setProperty("width",s.width),e.setProperty("order",s.order)}),a.setStyle(t),a.setMap(d),p[n]=a,o(r,i)}).always(function(){m.fadeOut()})}$("i",this).toggleClass("highlight")}function a(e){var n=[],a=new google.maps.LatLngBounds;m.fadeIn(),$.each(e,function(e,s){var i=Publish.path+e+".geojson";n.push($.getJSON(i,function(n){var i=new google.maps.Data,r=s.select||e,l=s.color;i.addGeoJson(n),i.forEach(function(e){"object"==$.type(l)?e.setProperty("color",l[e.getProperty(r)]):e.setProperty("color",l),e.setProperty("border",s.border),e.setProperty("width",s.width),e.getGeometry().forEachLatLng(function(e){a.extend(e)})}),i.setStyle(t),i.addListener("click",function(){$("#modal-report-"+e).modal("show")}),p[e]=i,s.visible&&(u.text(s.description||""),$("#"+e).children("i").toggleClass("highlight"),i.setMap(d),o(l,r))}))}),setTimeout(function(){$.when(n).then(function(){d.fitBounds(a),m.fadeOut()})},1e3)}function s(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");d=new google.maps.Map(o,e),d.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),$("#layers").find(":button").click(n),Publish.zoom||a(Publish.data)}function i(){var e=$(".mini-submenu-left");e.is(":visible")?$("#map").find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed"):$("#map").find(".ol-zoom").css("margin-left",$(".sidebar-left").width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}function r(){return $(".sidebar").width()==$(window).width()}function l(){r()&&($(".sidebar-left .sidebar-body").fadeOut("slide"),$(".mini-submenu-left").fadeIn())}var d,p={},c=$("#legend"),m=$("#loader"),u=$("#layer-description");google.maps.event.addDomListener(window,"load",s),$(".sidebar-left .slide-submenu").on("click",function(){var e=$(this);e.closest(".sidebar-body").fadeOut("slide",function(){$(".mini-submenu-left").fadeIn(),i()})}),$(".mini-submenu-left").on("click",function(){var e=$(this);$(".sidebar-left .sidebar-body").toggle("slide"),e.hide(),i()});var g=$(".modal-fullscreen");g.on("show.bs.modal",function(e){var o=e.target.id;o=o.replace("modal-report","#map-modal"),setTimeout(function(){$(".modal-backdrop").addClass("modal-backdrop-fullscreen"),$(o).append(d.getDiv())},0)}),g.on("hidden.bs.modal",function(){$(".modal-backdrop").addClass("modal-backdrop-fullscreen"),$("#map-canvas").append(d.getDiv())}),$(window).on("resize",i),$("#modal-app-description").modal("show"),l(),i()});