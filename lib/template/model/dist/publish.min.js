$(function(){function e(e,o,t){var i=$('<div style="height:25px;">').append($('<div class="legend-color-box">').css({backgroundColor:o})).append($("<span>").css("lineHeight","23px").html(t));e.append(i)}function o(o){b.empty(),O.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,i){var n=o[i];e(b,n,i)})}function t(e,t){var i=e.label;C.text(t||" Description"),P.text(e.description||""),o(i)}function i(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function n(e,o,t,i){var n=e.getGeometry(),s=n.getType();return"Point"===s||"MultiPoint"===s?e.setProperty("icon",o.icon):("object"==$.type(t)?e.setProperty("color",t[e.getProperty(i)]):e.setProperty("color",t),e.setProperty("border",o.border),e.setProperty("width",o.width)),e.setProperty("order",o.order),n}function s(e,o,t){e.setStyle(i),e.addListener("click",function(e){if(!o.geom||"Point"!==o.geom&&"MultiPoint"!==o.geom)$("#modal-report-"+t).modal("show");else{var i=e.feature.getProperty(o.select);"string"==$.type(i)&&(i=i.replace(/\s/g,"-")),$("#modal-report-"+t+i).modal("show")}}),m[t]=e}function a(e){var o=e.target.id,i=m[o];if(h[o]||(h[o]=e.target.innerText),i){var a=v.hasClass("in"),l=w.hasClass("in");if(i.getMap()){i.setMap(null);var r=f.indexOf(o);if(r>=0){f.splice(r,1);var d=f.length;d>0?(o=f[d-1],t(Publish.data[o],h[o])):(b.empty(),P.empty(),C.text(" Description"),a&&C.click(),l&&O.click())}}else t(Publish.data[o],h[o]),i.setMap(g),f.push(o),a||C.click(),l||O.click()}else{y.fadeIn();var p=Publish.path+o+".geojson";$.getJSON(p,function(e){i=new google.maps.Data;var a=Publish.data[o],l=a.select||o,r=a.color;u(a,o),i.addGeoJson(e),i.forEach(function(e){n(e,a,r,l)}),s(i,a,o),i.setMap(g),t(a,h[o]),f.push(o)}).always(function(){y.fadeOut()})}$("i",this).toggleClass("highlight")}function l(e){var o=[],i=new google.maps.LatLngBounds;y.fadeIn(),e.each(function(e,t){var a=t.id,l=Publish.data[a];u(l,a);var r=Publish.path+a+".geojson";o.push($.getJSON(r,function(e){var o=new google.maps.Data,t=l.select||a,r=l.color;o.addGeoJson(e),o.forEach(function(e){var o=n(e,l,r,t);o.forEachLatLng(function(e){i.extend(e)})}),s(o,l,a),l.visible&&($("#"+a).children("i").toggleClass("highlight"),o.setMap(g),f.push(a))}))}),$.when.apply($,o).done(function(){g.fitBounds(i);var e=f[0];e&&t(Publish.data[e])}).always(function(){y.fadeOut()})}function r(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");g=new google.maps.Map(o,e),g.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),$layers=$("#layers").find(":button"),$layers.click(a),Publish.zoom||google.maps.event.addListenerOnce(g,"idle",function(){l($layers)})}function d(){var e=$(".mini-submenu-left");e.is(":visible")?$("#map").find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed"):$("#map").find(".ol-zoom").css("margin-left",$(".sidebar-left").width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}function p(){return $(".sidebar").width()==$(window).width()}function c(){p()&&($(".sidebar-left .sidebar-body").fadeOut("slide"),$(".mini-submenu-left").fadeIn())}function u(e,o){e.label||(e.label={},e.label[o]=e.color)}var g,m={},f=[],h={},b=$("#legend"),y=$("#loader"),P=$("#layer-description"),v=$("#properties"),w=$("#legends"),C=$("#description-title"),O=$("#legend-title");google.maps.event.addDomListener(window,"load",r),$(".sidebar-left .slide-submenu").on("click",function(){var e=$(this);e.closest(".sidebar-body").fadeOut("slide",function(){$(".mini-submenu-left").fadeIn(),d()})}),$(".mini-submenu-left").on("click",function(){var e=$(this);$(".sidebar-left .sidebar-body").toggle("slide"),e.hide(),d()}),$(window).on("resize",d),$("#modal-app-description").modal("show"),c(),d()});