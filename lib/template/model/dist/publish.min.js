$(function(){function e(e,o,t){var i=$('<div style="height:25px;">').append($('<div class="legend-color-box">').css({backgroundColor:o})).append($("<span>").css("lineHeight","23px").html(t));e.append(i)}function o(o){h.empty(),$("#legend-title").text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,i){var n=o[i];e(h,n,i)})}function t(e){var t=e.label;f.text(e.description||""),o(t)}function i(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function n(e){var o=e.target.id,n=u[o];if(n)if(n.getMap()){n.setMap(null);var s=g.indexOf(o);if(s>=0){g.splice(s,1);var l=g.length;l>0?t(Publish.data[g[l-1]]):(h.empty(),f.empty(),$("#properties").hasClass("in")&&$("#description-title").click(),$("#legends").hasClass("in")&&$("#legend-title").click())}}else t(Publish.data[o]),n.setMap(c),g.push(o),$("#properties").hasClass("in")||$("#description-title").click(),$("#legends").hasClass("in")||$("#legend-title").click();else{m.fadeIn();var a=Publish.path+o+".geojson";$.getJSON(a,function(e){n=new google.maps.Data;var s=Publish.data[o],l=s.select||o,a=s.color;p(s,o),n.addGeoJson(e),n.forEach(function(e){"object"==$.type(a)?e.setProperty("color",a[e.getProperty(l)]):e.setProperty("color",a),e.setProperty("border",s.border),e.setProperty("width",s.width),e.setProperty("order",s.order)}),n.setStyle(i),n.setMap(c),u[o]=n,t(s),g.push(o)}).always(function(){m.fadeOut()})}$("i",this).toggleClass("highlight")}function s(e){var o=[],n=new google.maps.LatLngBounds;m.fadeIn(),e.each(function(e,t){var s=t.id,l=Publish.data[s];p(l,s);var a=Publish.path+s+".geojson";o.push($.getJSON(a,function(e){var o=new google.maps.Data,t=l.select||s,a=l.color;o.addGeoJson(e),o.forEach(function(e){"object"==$.type(a)?e.setProperty("color",a[e.getProperty(t)]):e.setProperty("color",a),e.setProperty("border",l.border),e.setProperty("width",l.width),e.setProperty("icon",l.icon),e.getGeometry().forEachLatLng(function(e){n.extend(e)})}),o.setStyle(i),o.addListener("click",function(){$("#modal-report-"+s).modal("show")}),u[s]=o,l.visible&&($("#"+s).children("i").toggleClass("highlight"),o.setMap(c),g.push(s))}))}),$.when.apply($,o).done(function(){c.fitBounds(n);var e=g[0];e&&t(Publish.data[e])}).always(function(){m.fadeOut()})}function l(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");c=new google.maps.Map(o,e),c.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),$layers=$("#layers").find(":button"),$layers.click(n),Publish.zoom||google.maps.event.addListenerOnce(c,"idle",function(){s($layers)})}function a(){var e=$(".mini-submenu-left");e.is(":visible")?$("#map").find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed"):$("#map").find(".ol-zoom").css("margin-left",$(".sidebar-left").width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}function r(){return $(".sidebar").width()==$(window).width()}function d(){r()&&($(".sidebar-left .sidebar-body").fadeOut("slide"),$(".mini-submenu-left").fadeIn())}function p(e,o){e.label||(e.label={},e.label[o]=e.color)}var c,u={},g=[],h=$("#legend"),m=$("#loader"),f=$("#layer-description");google.maps.event.addDomListener(window,"load",l),$(".sidebar-left .slide-submenu").on("click",function(){var e=$(this);e.closest(".sidebar-body").fadeOut("slide",function(){$(".mini-submenu-left").fadeIn(),a()})}),$(".mini-submenu-left").on("click",function(){var e=$(this);$(".sidebar-left .sidebar-body").toggle("slide"),e.hide(),a()}),$(window).on("resize",a),$("#modal-app-description").modal("show"),d(),a()});