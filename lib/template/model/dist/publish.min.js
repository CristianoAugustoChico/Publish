$(function(){function e(e,o,t){var n=$('<div style="height:25px;">');o.endsWith(".png")?n.append($('<div class="legend-img-box">').css("background-image","url("+o+")")):n.append($('<div class="legend-color-box">').css({backgroundColor:o})),n.append($("<span>").css("lineHeight","23px").html(t)),e.append(n)}function o(o){G.empty(),N.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,n){var i=o[n];e(G,i,n)})}function t(e,t){var n=e.label,i=t||"Description";J.text(" "+i),S.text(e.description||""),o(n)}function n(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function i(e,o,t){t=t||e.getGeometry();var n=o.geom||t.getType(),i=z(o,1);if(!o.icon||"Point"!==n&&"MultiPoint"!==n){var a=i||o.id,r=o.color;"object"===$.type(r)?e.setProperty("color",r[e.getProperty(a)]):e.setProperty("color",r),e.setProperty("border",o.border),e.setProperty("width",o.width)}else{var s=o.icon.options[e.getProperty(i)];s||(s=o.icon.path),e.setProperty("icon",s)}return e.setProperty("order",o.order),t}function a(e,o){var t=o.id;e.setStyle(n),o.report&&e.addListener("click",function(e){if("function"===o.report){var n=e.feature.getProperty(z(o,0));"string"===$.type(n)&&(n=n.replace(/\s/g,"-")),$("#modal-report-"+t+n).modal("show")}else $("#modal-report-"+t).modal("show")}),T[t]=e}function r(e,o,t){$.each(o,function(o,n){n.getVisible()?v(e,n):(m(e,n,t),u(e,W.hasClass("in"),B.hasClass("in")))})}function s(e){return"LineString"===e.geom}function l(e){return"MultiLineString"===e.geom}function d(e){return s(e)||l(e)}function c(e){var o=T[e],t=Publish.data[e];if(o)if(d(t)){var n=t.icon.time;s(t)?r(t.id,o,n):$.each(o,function(e,o){r(t.id,o,n)})}else o.getMap()?(o.setMap(null),x(e,!1)):(o.setMap(I),x(e,!0),u(e,W.hasClass("in"),B.hasClass("in")));else{E.fadeIn();var i=Publish.path+e+".geojson";$.getJSON(i,function(n){o=new google.maps.Data,M(t),o.addGeoJson(n),d(t)?b(o,t):(y(o,t),o.setMap(I)),x(e,!0),u(e,W.hasClass("in"),B.hasClass("in"))}).always(function(){E.fadeOut()})}return e}function p(e,o){L=null,G.empty(),S.empty(),J.text(" Description"),Z.hide(),e&&(J.click(),J.prop("disabled",!0)),o&&(N.click(),N.prop("disabled",!0))}function u(e,o,n){L=e;var i=Publish.data[e];if(t(i,D[e]),o||(J.prop("disabled",!1),J.click()),n||(N.prop("disabled",!1),N.click()),i.download){var a=e+".zip";R.prop("href",Publish.path+a),R.prop("download",a),Z.show()}else Z.hide()}function f(e){var o=e.target.id;if(o){var t=W.hasClass("in"),n=B.hasClass("in");L===o?p(t,n):u(o,t,n)}else{if(!(o=e.target.name))return;var i=Publish.group;if(i){var a=Publish.data[o].group,r=i[a];r?(c(r),r===o?i[a]=null:(i[a]=o,c(o))):(i[a]=o,c(o))}else c(o)}}function g(e,o,t){var n=0,i=setInterval(function(){n=(n+1)%200;var e=o.get("icons");e[0].offset=n/2+"%",o.set("icons",e)},t);window.intervals||(window.intervals={}),window.intervals[e]||(window.intervals[e]=[]),window.intervals[e].push(i)}function h(e,o){var t=e.icon.options,n=[];o.forEachLatLng(function(e){n.push(e)});var i={path:t.path,anchor:new google.maps.Point(175,175),scale:.1,fillColor:t.fillColor,fillOpacity:t.fillOpacity,strokeWeight:t.strokeWeight},a={path:n,icons:[{icon:i}],strokeWeight:e.width,strokeColor:e.border||e.color,strokeOpacity:e.transparency};return new google.maps.Polyline(a)}function m(e,o,t){o.setMap(I),o.setVisible(!0),g(e,o,t)}function v(e,o){o.setMap(null),o.setVisible(!1),window.intervals&&$.each(window.intervals[e],function(e,o){clearInterval(o)})}function b(e,o){var t=[],n=o.visible,i=o.icon.time;e.forEach(function(e){var a=e.getGeometry();if(s(o)){var r=h(o,a);t.push(r),n&&m(o.id,r,i)}else if(l(o)){var d=[];$.each(a.getArray(),function(e,t){var a=h(o,t);d.push(a),n&&m(o.id,a,i)}),t.push(d)}}),T[o.id]=t,n&&x(o.id,!0)}function y(e,o,t){e.forEach(function(e){var n=e.getGeometry();i(e,o,n),t&&t(n)}),a(e,o)}function w(e){var o=[],t=new google.maps.LatLngBounds;E.fadeIn(),$.each(e,function(e,n){M(n);var i=Publish.path+e+".geojson";o.push($.getJSON(i,function(e){var o=new google.maps.Data;o.addGeoJson(e),d(n)?b(o,n):(y(o,n,function(e){e.forEachLatLng(function(e){t.extend(e)})}),n.visible&&(o.setMap(I),x(n.id,!0)))}))}),$.when.apply($,o).done(function(){I.fitBounds(t)}).always(function(){E.fadeOut()})}function P(){var e=$("#layers"),o=e.find(":button");o.each(function(e,o){D[o.id]=o.innerText}),o.click(f),J.prop("disabled",!0),N.prop("disabled",!0),Z.hide()}function C(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");I=new google.maps.Map(o,e),I.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),Publish.zoom||google.maps.event.addListenerOnce(I,"idle",function(){w(Publish.data)}),P()}function k(){if(j.is(":visible"))U.find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed");else{var e=$(".sidebar-left");U.find(".ol-zoom").css("margin-left",e.width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}if($("#logo")){var o=$(".navbar").height()-50;$("body").css("padding-top",o),j.css("margin-top",o)}}function O(){return H.width()===$(window).width()}function M(e){e.label||(e.label={},e.label[e.id]=e.color||e.border)}function x(e,o){$("#"+e).children("input").prop("checked",o)}function z(e,o){return"array"===$.type(e.select)?e.select[o]:e.select}var I,L,T={},D={},G=$("#legend"),E=$("#loader"),S=$("#layer-description"),W=$("#properties"),B=$("#legends"),J=$("#description-title"),N=$("#legend-title"),R=$("#download-title"),Z=$("#panel-download"),j=$(".mini-submenu-left"),H=$(".sidebar"),V=$(".sidebar-left .sidebar-body"),_=$(".sidebar-left .slide-submenu"),A=$("#modal-app-description"),U=$("#map");google.maps.event.addDomListener(window,"load",C),_.on("click",function(){$(this).closest(".sidebar-body").fadeOut("slide",function(){j.fadeIn(),k()})}),j.on("click",function(){var e=$(this);V.toggle("slide"),e.hide(),k()}),$(window).on("resize",k),A.modal("show"),function(){O()&&(V.fadeOut("slide"),j.fadeIn())}(),k()});