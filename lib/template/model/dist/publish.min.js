$(function(){function e(e,o,t){var i=$('<div style="height:25px;">');o.endsWith(".png")?i.append($('<div class="legend-img-box">').css("background-image","url("+o+")")):i.append($('<div class="legend-color-box">').css({backgroundColor:o})),i.append($("<span>").css("lineHeight","23px").html(t)),e.append(i)}function o(o){R.empty(),B.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,i){var n=o[i];e(R,n,i)})}function t(e,t){var i=e.label,n=t||"Description",r=e.description.split("."),a=r[0]?r[0]+".":"",s=$(".navbar").height()+40,l=40*($("#map").height()-s)/100,c=20*($("#map").height()-s)/100;$("#layers").height()<l&&(c=30*($("#map").height()-s)/100),$("#layers").css("max-height",l),$("#properties").css("max-height",c),$("#legends").css("max-height",c),r.length-1>1?$("#more").show():$("#more").hide(),A.text(" "+n),_.text(a||""),te.text(" "+n),ie.text(e.description||""),o(i)}function i(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function n(e,o,t){var i=o.geom||e.getGeometry().getType(),n=G(o,1);if(!o.icon||"Point"!==i&&"MultiPoint"!==i){var r=n||o.id,a=o.color;"object"===$.type(a)?e.setProperty("color",a[e.getProperty(r)]):e.setProperty("color",a),e.setProperty("border",o.border),e.setProperty("width",o.width)}else{var s=o.icon.options[e.getProperty(n)];s||(s=o.icon.path),e.setProperty("icon",s)}return e.setProperty("order",o.order),t}function r(e,o){var t=o.id;e.setStyle(i),o.report&&e.addListener("click",function(e){if("function"===o.report){var i=e.feature.getProperty(G(o,0));"string"===$.type(i)&&(i=i.replace(/\s/g,"")),$("#modal-report-"+t+i).modal("show")}else $("#modal-report-"+t).modal("show")}),E[t]=e}function a(e,o,t){$.each(o,function(o,i){i.getVisible()?v(e,i):(b(e,i,t),h(e,F.hasClass("in"),J.hasClass("in")))})}function s(e){return"LineString"===e.geom}function l(e){return"MultiLineString"===e.geom}function c(e){return s(e)||l(e)}function d(e,o){var t=Publish.path+e+".geojson";return $.getJSON(t,function(t){var i=new google.maps.Data;i.addGeoJson(t),c(o)?y(i,o):(w(i,o),i.setMap(S),W(e,!0))})}function p(e){var o=E[e],t=Publish.data[e];if(o)if(c(t)){var i=t.icon.time;s(t)?a(t.id,o,i):$.each(o,function(e,o){a(t.id,o,i)})}else o.getMap()?(o.setMap(null),W(e,!1)):(o.setMap(S),W(e,!0),h(e,F.hasClass("in"),J.hasClass("in")));else x(),V.empty(),C(e,1,1),d(e,t).done(function(){h(e,F.hasClass("in"),J.hasClass("in"))}).always(function(){k()})}function u(e,o){Z=null,R.empty(),_.empty(),A.text(" Description"),q.hide(),$("button").removeClass("button-selected"),e&&(A.click(),A.prop("disabled",!0)),o&&(B.click(),B.prop("disabled",!0))}function h(e,o,i){Z=e;var n=Publish.data[e];if(t(n,N[e]),o||(A.prop("disabled",!1),A.click()),i||(B.prop("disabled",!1),B.click()),n.download){var r=e+".zip";U.prop("href",Publish.path+r),U.prop("download",r),q.show()}else q.hide();$("button").removeClass("button-selected"),$("#"+e).addClass("button-selected")}function f(e){var o=e.target.id;if(o){var t=F.hasClass("in"),i=J.hasClass("in");Z===o?u(t,i):h(o,t,i)}else{if(!(o=e.target.name))return;var n=Publish.group;if(n){var r=Publish.data[o].group,a=n[r];a?(p(a),a===o?n[r]=null:(n[r]=o,p(o))):(n[r]=o,p(o))}else p(o)}}function g(e,o,t){var i=0,n=setInterval(function(){i=(i+1)%200;var e=o.get("icons");e[0].offset=i/2+"%",o.set("icons",e)},t);window.intervals||(window.intervals={}),window.intervals[e]||(window.intervals[e]=[]),window.intervals[e].push(n)}function m(e,o){var t=e.icon.options,i=[];o.forEachLatLng(function(e){i.push(e)});var n={path:t.path,anchor:new google.maps.Point(175,175),scale:.1,fillColor:t.fillColor,fillOpacity:t.fillOpacity,strokeWeight:t.strokeWeight},r={path:i,icons:[{icon:n}],strokeWeight:e.width,strokeColor:e.border||e.color,strokeOpacity:e.transparency};return new google.maps.Polyline(r)}function b(e,o,t){o.setMap(S),o.setVisible(!0),g(e,o,t)}function v(e,o){o.setMap(null),o.setVisible(!1),window.intervals&&$.each(window.intervals[e],function(e,o){clearInterval(o)})}function y(e,o){var t=[],i=o.visible,n=o.icon.time;e.forEach(function(e){var r=e.getGeometry();if(s(o)){var a=m(o,r);t.push(a),i&&b(o.id,a,n)}else if(l(o)){var c=[];$.each(r.getArray(),function(e,t){var r=m(o,t);c.push(r),i&&b(o.id,r,n)}),t.push(c)}}),E[o.id]=t,i&&W(o.id,!0)}function w(e,o){e.forEach(function(e){n(e,o)}),r(e,o)}function P(e,o,t){return"Loading"+N[e]+" ("+o+"/"+t+")"}function C(e,o,t){var i=P(e,o,t);V.text(i)}function x(){j.fadeIn(),H.css("z-index",1e7)}function k(){j.fadeOut(),V.empty(),H.css("z-index",-1)}function M(e,o){function t(e,o,t){return Math.floor(Math.log(e/o/t)/Math.LN2)}if("number"===$.type(e))return e;var i=t(ne.height(),e.yTile,e.latFraction),n=t(ne.width(),e.xTile,e.longFraction);return Math.min(i,n,o)}function O(e){var o=[],t=0,i=Object.keys(e).length;x(),$.each(e,function(e,n){if(D(n),!n.visible)return!0;t+=1,V.empty(),C(e,t,i),o.push(d(e,n))}),$.when.apply($,o).always(function(){k()})}function T(){google.maps.visualRefresh=!0;var e={center:new google.maps.LatLng(Publish.center.lat,Publish.center.long),zoom:M(Publish.zoom,Publish.maxZoom),minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};S=new google.maps.Map(ne[0],e),S.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),z(),google.maps.event.addListenerOnce(S,"idle",function(){O(Publish.data)})}function z(){var e=$("#layers"),o=e.find(":button");o.each(function(e,o){N[o.id]=o.innerText}),o.click(f),A.prop("disabled",!0),B.prop("disabled",!0),q.hide()}function I(){if(K.is(":visible"))ne.find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed");else{var e=$(".sidebar-left");ne.find(".ol-zoom").css("margin-left",e.width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}if($("#logo")){var o=$(".navbar").height()-50;$("body").css("padding-top",o),K.css("margin-top",o)}}function L(){return Q.width()===$(window).width()}function D(e){e.label||(e.label={},e.label[e.id]=e.color||e.border)}function W(e,o){$("#"+e).children("input").prop("checked",o)}function G(e,o){return"array"===$.type(e.select)?e.select[o]:e.select}var S,Z,E={},N={},R=$("#legend"),j=$("#loader"),H=$("#loader-message"),V=$("#loader-message-text"),_=$("#layer-description"),F=$("#properties"),J=$("#legends"),A=$("#description-title"),B=$("#legend-title"),U=$("#download-title"),q=$("#panel-download"),K=$(".mini-submenu-left"),Q=$(".sidebar"),X=$(".sidebar-left .sidebar-body"),Y=$(".sidebar-left .slide-submenu"),ee=$("#modal-app-description"),oe=$("#modal-completed-description"),te=$("#modal-title-description"),ie=$("#info-description"),ne=$("#map"),re=$("#more");google.maps.event.addDomListener(window,"load",T),Y.on("click",function(){$(this).closest(".sidebar-body").fadeOut("slide",function(){K.fadeIn(),I()})}),K.on("click",function(){var e=$(this);X.toggle("slide"),e.hide(),I()}),re.on("click",function(){oe.modal("show")}),$(window).on("resize",I),ee.modal("show"),function(){L()&&(X.fadeOut("slide"),K.fadeIn())}(),I()});