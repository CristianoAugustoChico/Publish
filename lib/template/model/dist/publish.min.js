$(function(){function e(e,o,t){var n=$('<div style="height:25px;">').append($('<div class="legend-color-box">').css({backgroundColor:o})).append($("<span>").css("lineHeight","23px").html(t));e.append(n)}function o(o){h.empty(),C.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,n){var i=o[n];e(h,i,n)})}function t(e){var t=e.label;y.text(e.description||""),o(t)}function n(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function i(e,o,t,n){var i=e.getGeometry(),a=i.getType();return"Point"===a||"MultiPoint"===a?e.setProperty("icon",o.icon):("object"==$.type(t)?e.setProperty("color",t[e.getProperty(n)]):e.setProperty("color",t),e.setProperty("border",o.border),e.setProperty("width",o.width)),e.setProperty("order",o.order),i}function a(e,o,t){e.setStyle(n),e.addListener("click",function(e){if(!o.geom||"Point"!==o.geom&&"MultiPoint"!==o.geom)$("#modal-report-"+t).modal("show");else{var n=e.feature.getProperty(o.select);"string"==$.type(n)&&(n=n.replace(/\s/g,"-")),$("#modal-report-"+t+n).modal("show")}}),m[t]=e}function s(e){var o=e.target.id,n=m[o];if(n){var s=P.hasClass("in"),l=v.hasClass("in");if(n.getMap()){n.setMap(null);var r=f.indexOf(o);if(r>=0){f.splice(r,1);var d=f.length;d>0?t(Publish.data[f[d-1]]):(h.empty(),y.empty(),s&&w.click(),l&&C.click())}}else t(Publish.data[o]),n.setMap(g),f.push(o),s||w.click(),l||C.click()}else{b.fadeIn();var p=Publish.path+o+".geojson";$.getJSON(p,function(e){n=new google.maps.Data;var s=Publish.data[o],l=s.select||o,r=s.color;u(s,o),n.addGeoJson(e),n.forEach(function(e){i(e,s,r,l)}),a(n,s,o),n.setMap(g),t(s),f.push(o)}).always(function(){b.fadeOut()})}$("i",this).toggleClass("highlight")}function l(e){var o=[],n=new google.maps.LatLngBounds;b.fadeIn(),e.each(function(e,t){var s=t.id,l=Publish.data[s];u(l,s);var r=Publish.path+s+".geojson";o.push($.getJSON(r,function(e){var o=new google.maps.Data,t=l.select||s,r=l.color;o.addGeoJson(e),o.forEach(function(e){var o=i(e,l,r,t);o.forEachLatLng(function(e){n.extend(e)})}),a(o,l,s),l.visible&&($("#"+s).children("i").toggleClass("highlight"),o.setMap(g),f.push(s))}))}),$.when.apply($,o).done(function(){g.fitBounds(n);var e=f[0];e&&t(Publish.data[e])}).always(function(){b.fadeOut()})}function r(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");g=new google.maps.Map(o,e),g.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),$layers=$("#layers").find(":button"),$layers.click(s),Publish.zoom||google.maps.event.addListenerOnce(g,"idle",function(){l($layers)})}function d(){var e=$(".mini-submenu-left");e.is(":visible")?$("#map").find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed"):$("#map").find(".ol-zoom").css("margin-left",$(".sidebar-left").width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}function p(){return $(".sidebar").width()==$(window).width()}function c(){p()&&($(".sidebar-left .sidebar-body").fadeOut("slide"),$(".mini-submenu-left").fadeIn())}function u(e,o){e.label||(e.label={},e.label[o]=e.color)}var g,m={},f=[],h=$("#legend"),b=$("#loader"),y=$("#layer-description"),P=$("#properties"),v=$("#legends"),w=$("#description-title"),C=$("#legend-title");google.maps.event.addDomListener(window,"load",r),$(".sidebar-left .slide-submenu").on("click",function(){var e=$(this);e.closest(".sidebar-body").fadeOut("slide",function(){$(".mini-submenu-left").fadeIn(),d()})}),$(".mini-submenu-left").on("click",function(){var e=$(this);$(".sidebar-left .sidebar-body").toggle("slide"),e.hide(),d()}),$(window).on("resize",d),$("#modal-app-description").modal("show"),c(),d()});