$(function(){function e(e,o,t){var n=$('<div style="height:25px;">');o.endsWith(".png")?n.append($('<div class="legend-img-box">').css("background-image","url("+o+")")):n.append($('<div class="legend-color-box">').css({backgroundColor:o})),n.append($("<span>").css("lineHeight","23px").html(t)),e.append(n)}function o(o){W.empty(),H.text(" "+Publish.legend);var t=[];$.each(o,function(e){t.push(e)}),t.sort(),$.each(t,function(t,n){var i=o[n];e(W,i,n)})}function t(e,t){var n=e.label,i=t||"Description",s=e.description.split("."),a=s[0]?s[0]+".":"",r=$(".navbar").height()+26,l=40*($("#map").height()-r)/100,d=20*($("#map").height()-r)/100;$("#layers").height()<l&&(d=30*($("#map").height()-r)/100),$("#layers").css("max-height",l),$("#properties").css("max-height",d),$("#legends").css("max-height",d),s.length-1>1?$("#more").show():$("#more").hide(),B.text(" "+i),N.text(a||""),X.text(" "+i),Y.text(e.description||""),o(n)}function n(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order"),icon:e.getProperty("icon")}}function i(e,o,t){t=t||e.getGeometry();var n=o.geom||t.getType(),i=T(o,1);if(!o.icon||"Point"!==n&&"MultiPoint"!==n){var s=i||o.id,a=o.color;"object"===$.type(a)?e.setProperty("color",a[e.getProperty(s)]):e.setProperty("color",a),e.setProperty("border",o.border),e.setProperty("width",o.width)}else{var r=o.icon.options[e.getProperty(i)];r||(r=o.icon.path),e.setProperty("icon",r)}return e.setProperty("order",o.order),t}function s(e,o){var t=o.id;e.setStyle(n),o.report&&e.addListener("click",function(e){if("function"===o.report){var n=e.feature.getProperty(T(o,0));"string"===$.type(n)&&(n=n.replace(/\s/g,"-")),$("#modal-report-"+t+n).modal("show")}else $("#modal-report-"+t).modal("show")}),G[t]=e}function a(e,o,t){$.each(o,function(o,n){n.getVisible()?b(e,n):(m(e,n,t),u(e,R.hasClass("in"),Z.hasClass("in")))})}function r(e){return"LineString"===e.geom}function l(e){return"MultiLineString"===e.geom}function d(e){return r(e)||l(e)}function c(e){var o=G[e],t=Publish.data[e];if(o)if(d(t)){var n=t.icon.time;r(t)?a(t.id,o,n):$.each(o,function(e,o){a(t.id,o,n)})}else o.getMap()?(o.setMap(null),z(e,!1)):(o.setMap(I),z(e,!0),u(e,R.hasClass("in"),Z.hasClass("in")));else{E.fadeIn();var i=Publish.path+e+".geojson";$.getJSON(i,function(n){o=new google.maps.Data,M(t),J.empty(),P(e,1,1),o.addGeoJson(n),d(t)?v(o,t):(y(o,t),o.setMap(I)),z(e,!0),u(e,R.hasClass("in"),Z.hasClass("in"))}).always(function(){E.fadeOut(),j.remove()})}return e}function p(e,o){D=null,W.empty(),N.empty(),B.text(" Description"),_.hide(),$("button").removeClass("button-selected"),e&&(B.click(),B.prop("disabled",!0)),o&&(H.click(),H.prop("disabled",!0))}function u(e,o,n){D=e;var i=Publish.data[e];if(t(i,S[e]),o||(B.prop("disabled",!1),B.click()),n||(H.prop("disabled",!1),H.click()),i.download){var s=e+".zip";V.prop("href",Publish.path+s),V.prop("download",s),_.show()}else _.hide();$("button").removeClass("button-selected"),$("#"+e).addClass("button-selected")}function h(e){var o=e.target.id;if(o){var t=R.hasClass("in"),n=Z.hasClass("in");D===o?p(t,n):u(o,t,n)}else{if(!(o=e.target.name))return;var i=Publish.group;if(i){var s=Publish.data[o].group,a=i[s];a?(c(a),a===o?i[s]=null:(i[s]=o,c(o))):(i[s]=o,c(o))}else c(o)}}function f(e,o,t){var n=0,i=setInterval(function(){n=(n+1)%200;var e=o.get("icons");e[0].offset=n/2+"%",o.set("icons",e)},t);window.intervals||(window.intervals={}),window.intervals[e]||(window.intervals[e]=[]),window.intervals[e].push(i)}function g(e,o){var t=e.icon.options,n=[];o.forEachLatLng(function(e){n.push(e)});var i={path:t.path,anchor:new google.maps.Point(175,175),scale:.1,fillColor:t.fillColor,fillOpacity:t.fillOpacity,strokeWeight:t.strokeWeight},s={path:n,icons:[{icon:i}],strokeWeight:e.width,strokeColor:e.border||e.color,strokeOpacity:e.transparency};return new google.maps.Polyline(s)}function m(e,o,t){o.setMap(I),o.setVisible(!0),f(e,o,t)}function b(e,o){o.setMap(null),o.setVisible(!1),window.intervals&&$.each(window.intervals[e],function(e,o){clearInterval(o)})}function v(e,o){var t=[],n=o.visible,i=o.icon.time;e.forEach(function(e){var s=e.getGeometry();if(r(o)){var a=g(o,s);t.push(a),n&&m(o.id,a,i)}else if(l(o)){var d=[];$.each(s.getArray(),function(e,t){var s=g(o,t);d.push(s),n&&m(o.id,s,i)}),t.push(d)}}),G[o.id]=t,n&&z(o.id,!0)}function y(e,o,t){e.forEach(function(e){var n=e.getGeometry();i(e,o,n),t&&t(n)}),s(e,o)}function w(e,o,t){return"Loading"+S[e]+" ("+o+"/"+t+")"}function P(e,o,t){var n=w(e,o,t);J.text(n)}function C(e){var o=[],t=0,n=Object.keys(e).length,i=new google.maps.LatLngBounds;E.fadeIn(),$.each(e,function(e,s){M(s),t+=1,J.empty(),P(e,t,n);var a=Publish.path+e+".geojson";o.push($.getJSON(a,function(e){var o=new google.maps.Data;o.addGeoJson(e),d(s)?v(o,s):(y(o,s,function(e){e.forEachLatLng(function(e){i.extend(e)})}),s.visible&&(o.setMap(I),z(s.id,!0)))}))});var s=R.hasClass("in"),a=Z.hasClass("in");u($("button")[0].id,s,a),$.when.apply($,o).done(function(){I.fitBounds(i)}).always(function(){E.fadeOut(),j.remove()})}function k(){var e=$("#layers"),o=e.find(":button");o.each(function(e,o){S[o.id]=o.innerText}),o.click(h),B.prop("disabled",!0),H.prop("disabled",!0),_.hide()}function x(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom),I=new google.maps.Map(ee[0],e),I.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),Publish.zoom||google.maps.event.addListenerOnce(I,"idle",function(){C(Publish.data)}),k()}function O(){if(A.is(":visible"))ee.find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed");else{var e=$(".sidebar-left");ee.find(".ol-zoom").css("margin-left",e.width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}if($("#logo")){var o=$(".navbar").height()-50;$("body").css("padding-top",o),A.css("margin-top",o)}}function L(){return U.width()===$(window).width()}function M(e){e.label||(e.label={},e.label[e.id]=e.color||e.border)}function z(e,o){$("#"+e).children("input").prop("checked",o)}function T(e,o){return"array"===$.type(e.select)?e.select[o]:e.select}var I,D,G={},S={},W=$("#legend"),E=$("#loader"),j=$("#loader-message"),J=$("#loader-message-text"),N=$("#layer-description"),R=$("#properties"),Z=$("#legends"),B=$("#description-title"),H=$("#legend-title"),V=$("#download-title"),_=$("#panel-download"),A=$(".mini-submenu-left"),U=$(".sidebar"),q=$(".sidebar-left .sidebar-body"),F=$(".sidebar-left .slide-submenu"),K=$("#modal-app-description"),Q=$("#modal-completed-description"),X=$("#modal-title-description"),Y=$("#info-description"),ee=$("#map"),oe=$("#more");google.maps.event.addDomListener(window,"load",x),F.on("click",function(){$(this).closest(".sidebar-body").fadeOut("slide",function(){A.fadeIn(),O()})}),A.on("click",function(){var e=$(this);q.toggle("slide"),e.hide(),O()}),oe.on("click",function(){Q.modal("show")}),$(window).on("resize",O),K.modal("show"),function(){L()&&(q.fadeOut("slide"),A.fadeIn())}(),O()});